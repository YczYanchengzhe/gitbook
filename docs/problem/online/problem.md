# 线上故障总结



## 1. 项目启动脚本上线之后出现语法错误,排查修改的代码没有找到问题

原因 : 脚本中出现 ^M , 在windows会被解析为换行,原来被注释的代码出现了这个符号 , 本地编辑之后直接上传,导致应该被注释的代码没有被注释,进而导致脚本执行错误.

避免 : 上线前进行测试,对于功能进行测试,尤其是这种语法问题,更要在线上严格避免,对于脚本windows和Linux下会有不同效果的更要谨慎.

## 2. 数据回写问题
问题描述 : 在项目中为了避免数据频繁读取,加入了一层缓存,同时由于数据库中存在历史数据,需要启动一个定时任务进行历史数据删除,在设计缓存的时候,缓存如果未命中会在数据库中查找.并且定时将缓存的数据写入数据库,于是出现一个问题,即使定时任务把历史数据删除了,缓存在写入时候仍然会把历史数据写回数据库,出现删除失败问题.

问题解决 : 采用双缓存策略,读写缓存拆分.
当有数据上报时候,这部分数据是需要定时写入数据库的,将这部分数据加入到写缓存中,设置过期时间.
当访问时候,会访问读缓存,读缓存未命中时候在数据库中拉取数据,该缓存数据不会写入数据库.